# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –§–ù–° API

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –±–æ—Ç–∞ YouTravel —Å API –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–π –Ω–∞–ª–æ–≥–æ–≤–æ–π —Å–ª—É–∂–±—ã (–§–ù–°) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ò–ù–ù —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ò–ù–ù** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –±–∞–∑—É –§–ù–°
2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–ø–∞–Ω–∏–∏** - –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ç–∏–ø, —Å—Ç–∞—Ç—É—Å
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–∞–Ω–∏–∏** - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
4. **Fallback –Ω–∞ –º–æ–∫-–¥–∞–Ω–Ω—ã–µ** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API
5. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

#### –ú–æ–¥—É–ª–∏

- `fns_api.py` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –§–ù–° API
- `utils.py` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –§–ù–°
- `bot.py` - –æ–±–Ω–æ–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ò–ù–ù
- `sheets.py` - –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–ø–∞–Ω–∏–∏

#### API Endpoints

- **–ë–∞–∑–æ–≤—ã–π URL**: `https://api-fns.ru/api`
- **Endpoint**: `/egr` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –ï–ì–†–Æ–õ/–ï–ì–†–ò–ü
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `key`, `inn`, `format`

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
FNS_API_KEY=your_fns_api_key_here
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from fns_api import validate_inn_with_fns, get_company_by_inn

# –í–∞–ª–∏–¥–∞—Ü–∏—è –ò–ù–ù
result = await validate_inn_with_fns("7707083893")
print(result)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–ø–∞–Ω–∏–∏
company_info = await get_company_by_inn("7707083893")
print(company_info)
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –±–æ—Ç–µ

–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ò–ù–ù —Ç–µ–ø–µ—Ä—å:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –ò–ù–ù
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ –±–∞–∑–µ
3. **–ù–û–í–û–ï**: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ò–ù–ù —á–µ—Ä–µ–∑ –§–ù–° API
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–∞–Ω–∏–∏
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

#### –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```python
{
    'valid': True,           # –í–∞–ª–∏–¥–Ω—ã–π –ª–∏ –ò–ù–ù
    'found': True,           # –ù–∞–π–¥–µ–Ω –ª–∏ –≤ –±–∞–∑–µ –§–ù–°
    'company_info': {        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏
        'inn': '7707083893',
        'name': '–û–û–û "–Ø–Ω–¥–µ–∫—Å"',
        'type': '–Æ–õ',
        'status': 'ACTIVE',
        'is_active': True,
        # ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
    }
}
```

#### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏
```python
{
    'inn': '7707083893',
    'name': '–û–û–û "–Ø–Ω–¥–µ–∫—Å"',
    'ogrn': '1027700229193',
    'kpp': '770701001',
    'address': '–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –õ—å–≤–∞ –¢–æ–ª—Å—Ç–æ–≥–æ, 16',
    'status': 'ACTIVE',
    'type': '–Æ–õ',
    'registration_date': '2000-01-01',
    'last_update': '2024-01-01',
    'is_active': True,
    'found': True
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
python test_fns_integration.py
```

### –¢–µ—Å—Ç–æ–≤—ã–µ –ò–ù–ù

- `1234567890` - —Ç–µ—Å—Ç–æ–≤—ã–π –ò–ù–ù (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –º–æ–∫-–¥–∞–Ω–Ω—ã–º–∏)
- `7707083893` - —Ä–µ–∞–ª—å–Ω—ã–π –ò–ù–ù –Ø–Ω–¥–µ–∫—Å–∞
- `123456789012` - —Ç–µ—Å—Ç–æ–≤—ã–π –ò–ù–ù –ò–ü

### –ú–æ–∫-–¥–∞–Ω–Ω—ã–µ

–ï—Å–ª–∏ `FNS_API_KEY` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–∫-—Ä–µ–∂–∏–º:
- –ò–ù–ù —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ "123" –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –ò–ù–ù –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ"

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [api-fns.ru](https://api-fns.ru)
2. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á
3. –î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
   ```bash
   FNS_API_KEY=your_api_key_here
   ```

### 2. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

–ï—Å–ª–∏ api-fns.ru –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- [DaMIA API](https://damia.ru/apifns)
- [OfData API](https://ofdata.ru/api)
- –ü—Ä—è–º–æ–µ API –§–ù–° (—Ç—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–í `config.py` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞:
```python
FNS_API_KEY = os.getenv("FNS_API_KEY")
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è API

- **Rate limiting**: –û–±—ã—á–Ω–æ 100-1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å
- **–¢–∞–π–º–∞—É—Ç—ã**: 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö

- –ò–ù–ù –º–∞—Å–∫–∏—Ä—É—é—Ç—Å—è –≤ –ª–æ–≥–∞—Ö
- API –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```python
# –£—Å–ø–µ—à–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
logger.info(f"Company found: {company_name} ({company_type})")

# –û—à–∏–±–∫–∏ API
logger.error(f"FNS API error: HTTP {response.status}")

# –¢–∞–π–º–∞—É—Ç—ã
logger.error("FNS API request timeout")
```

### –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –§–ù–° API
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–π
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –í–µ—Ç–∫–∞

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ:
```bash
git checkout feature/fns-api-integration
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```python
aiohttp>=3.8.0  # –î–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
BOT_TOKEN=your_bot_token
DATABASE_URL=your_database_url
GOOGLE_SHEET_EMAILS_ID=your_sheet_id
GOOGLE_SHEET_PROMOS_ID=your_promos_sheet_id

# –ù–æ–≤—ã–µ –¥–ª—è –§–ù–° API
FNS_API_KEY=your_fns_api_key  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –º–æ–∫-—Ä–µ–∂–∏–º–∞
```

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

1. **"FNS API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ –º–æ–∫-–¥–∞–Ω–Ω—ã–µ

2. **"–ò–ù–ù –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –§–ù–°"**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ò–ù–ù
   - –ö–æ–º–ø–∞–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω–∞
   - –ò–ù–ù –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º

3. **"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ò–ù–ù"**
   - –ü—Ä–æ–±–ª–µ–º—ã —Å API
   - –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
   - –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞

### –û—Ç–ª–∞–¥–∫–∞

```python
# –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logging.getLogger('fns_api').setLevel(logging.DEBUG)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
async with FNSAPI() as api:
    result = await api.get_company_info("1234567890")
    print(result)
```

## –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)

- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- [ ] –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞)

- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Å–±–æ—è—Ö
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3+ –º–µ—Å—è—Ü–∞)

- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ API
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫**: YouTravel Team
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**: @youtravel_for_agents
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –≠—Ç–æ—Ç —Ñ–∞–π–ª
- **Issues**: GitHub Issues

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: $(date)*
